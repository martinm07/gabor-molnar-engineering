<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register | Test</title>
  </head>

  <body style="margin: 0">
    <div id="app"></div>
    <script data-info="https://stackoverflow.com/a/43834063">
      // awsome guy on [data-info] wrote 90% of this but I added the mutation/module-type part

      let l,
        e,
        t = "script",
        p = /(from\s+|import\s+)['"](#[\w\-]+)['"]/g,
        x = "textContent",
        d = document,
        s,
        o;

      let evls = (event) => (
        event.target.type === "javascript/blocked",
        event.preventDefault(),
        event.target.removeEventListener("beforescriptexecute", evls)
      );

      new MutationObserver((mutations) =>
        mutations.forEach(({ addedNodes }) =>
          addedNodes.forEach(
            (node) =>
              node.nodeType === 1 &&
              node.matches(t + "[module-type=inline]") &&
              ((node.type = "javascript/blocked"),
              node.addEventListener("beforescriptexecute", evls),
              (o = node),
              (l = d.createElement(t)),
              o.id ? (l.id = o.id) : 0,
              (l.type = "module"),
              (l[x] = o[x].replace(p, (u, a, z) =>
                (e = d.querySelector(t + z + "[type=module][src]"))
                  ? a + `/* ${z} */'${e.src}'`
                  : u
              )),
              (l.src = URL.createObjectURL(
                new Blob([l[x]], { type: "application/java" + t })
              )),
              o.replaceWith(l)) //inline
          )
        )
      ).observe(document.documentElement, {
        childList: true,
        subtree: true,
      });

      // for(o of d.querySelectorAll(t+'[module-type=inline]'))
      //   l=d.createElement(t),
      //   o.id?l.id=o.id:0,
      //   l.type='module',
      //   l[x]=o[x].replace(p,(u,a,z)=>
      //     (e=d.querySelector(t+z+'[type=module][src]'))
      //       ?a+`/* ${z} */'${e.src}'`
      //       :u),
      //   l.src=URL.createObjectURL(
      //     new Blob([l[x]],
      //     {type:'application/java'+t})),
      //   o.replaceWith(l)//inline
    </script>

    <script type="text/javascript">
      "use strict";
      // let csrf_token;
      try {
        globalThis.jinjaParsed = false;
        if (!Number.parseInt("{{ 1 }}"))
          throw new Error("Jinja wasn't parsed.");
        globalThis.jinjaParsed = true;

        globalThis.csrf_token = "{{ csrf_token() }}";
      } catch (err) {
        console.log(err);
      }
    </script>
    <!--<script type="module" src="./jinja-vars.js"></script>-->
    <script type="module" src="./main.js"></script>
  </body>
</html>
